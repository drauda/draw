<html>
<head>


<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="HandheldFriendly" content="true">

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">

<!-- Optional theme -->
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">

<link rel="stylesheet" href="untitled.css">
<link rel="stylesheet" href="css/tinycolorpicker.css">
<script src= "multidraw.js"></script>
<script src= "SVGdraw.js"></script>
<script src= "canvasDraw.js"></script>
<script src= "pointerdraw.js"></script>
<script src= "VMLdraw.js"></script>
<script src= "svgcolors.js"></script>
<script src= "hammer.js"></script>
<script type="text/javascript">
var canvas, ctx, flag = false,
    prevX = 0,
    currX = 0,
    prevY = 0,
    currY = 0,
    dot_flag = false;

// var x = "black",
//     y = 2;

LINEWIDTH = 5;

// function changeColorTo(col) {
//     x = col;
// }







function init() {
    // canvas = document.getElementById('can');
    // ctx = canvas.getContext("2d");
    // canvas.width=window.innerWidth - 20; 
   	// 	canvas.height=window.innerHeight-70;
    // w = canvas.width;
    // h = canvas.height;

   // window.addEventListener("resize", function (e){
   // 		console.log("resize", window.innerWidth, window.innerHeight);
   // 		canvas.width=window.innerWidth - 20; 
   // 		canvas.height=window.innerHeight-70;
   // })
   // var c = Hammer(canvas);	
   //  c.on("drag", function (e) {
   //      findxy('move', e.gesture.touches[0])
   //      e.preventDefault()
   //  }, false);
   //  c.on("dragstart", function (e) {
   //      console.log(e.gesture.touches)
   //      findxy('down', e.gesture.touches[0])
   //      e.preventDefault()
   //  }, false);
   //  c.on("dragend", function (e) {
   //      findxy('up', e.gesture.touches[0])
   //      e.preventDefault()
   //  }, false);
   //  window.addEventListener('touchmove',function(e)
   //  {
   //  	e.preventDefault();
   //  })
}

// function color(obj) {
//     switch (obj.id) {
//         case "green":
//             x = "#339900";
//             break;
//         case "blue":
//             x = "blue";
//             break;
//         case "red":
//             x = "red";
//             break;
//         case "yellow":
//             x = "yellow";
//             break;
//         case "orange":
//             x = "#FF6600";
//             break;
//         case "black":
//             x = "black";
//             break;
//         case "white":
//             x = "white";
//             break;
//     }
//     if (x == "white") y = 14;
//     else y = 50;

// }

function draw() {
    ctx.beginPath();
    ctx.moveTo(prevX, prevY);
    ctx.lineTo(currX, currY);
    ctx.strokeStyle = x;
    ctx.lineWidth = y;
    ctx.stroke();
    ctx.closePath();
}

function erase() {
    var m = confirm("Are you sure you want to delete this?");
    if (m) {
        $("canvas").each(function(){
            console.log(this);
            if (this.width > 150)
              this.getContext("2d").clearRect(0, 0, this.width, this.height);
        })
        //window.CTX.clearRect(0, 0, window.CTX.canvas.width, window.CTX.canvas.height);
        //document.getElementById("canvasimg").style.display = "none";
    }
}

//function save() {
   // document.getElementById("canvasimg").style.border = "2px solid";
   // var dataURL = canvas.toDataURL();
  //  document.getElementById("canvasimg").src = dataURL;
  //  document.getElementById("canvasimg").style.display = "inline";
//}

function findxy(res, e) {
    if (res == 'down') {
        prevX = currX;
        prevY = currY;
        currX = e.clientX - canvas.offsetLeft;
        currY = e.clientY - canvas.offsetTop;

        flag = true;
        dot_flag = true;
        if (dot_flag) {
            ctx.beginPath();
            ctx.fillStyle = x;
            ctx.fillRect(currX, currY, 2, 2);
            ctx.closePath();
            dot_flag = false;
        }
    }
    if (res == 'up' || res == "out") {
        flag = false;
    }
    if (res == 'move') {
        if (flag) {
            prevX = currX;
            prevY = currY;
            currX = e.clientX - canvas.offsetLeft;
            currY = e.clientY - canvas.offsetTop;
            draw();
        }
    }
}


</script>

</head>
<body style="overflow:hidden;" onload="init()">
<div class= "drawingelements">
<!--     <canvas id="can" width="1000" height="1000" style="position:absolute;top:180px;left:15px; right: 10px; bottom: 10px; border: 1px solid black"></canvas></div>
 -->

<div style="padding: 0 0.25in; width: 100%; height: 100%; padding-top:180px; padding-bottom: 10px">
        <div style="border: 1px solid gray; box-shadow: rgba(0,0,0,0.4) 2px 2px 5px;" >
            <div class="multidrawTarget" style="overflow: hidden; width: 100%; height: 100%;">
            </div>
        </div>
    </div>


    

<div id="middle">
<!--<div id="middle" style="position:absolute;top:10px;left:36%;text-align:center;"> -->
    <div style="font-family:sans-serif;color:#00FFFF;"><strong>Choose color</strong></div>
   <!-- <div style="position:absolute;top:5%;left:36%;width:30px;height:30px;border-radius:100px; background:#339900;" id="green" onclick="color(this)"></div>
    <div style="position:absolute;top:5%;left:40%;width:30px;height:30px;background:blue;border-radius:100px;" id="blue" onclick="color(this)"></div>
    <div style="position:absolute;top:5%;left:44%;width:30px;height:30px;background:red;border-radius:100px;" id="red" onclick="color(this)"></div>
    <div style="position:absolute;top:5%;left:48%;width:30px;height:30px;background:yellow;border-radius:100px;" id="yellow" onclick="color(this)"></div>
    <div style="position:absolute;top:5%;left:52%;width:30px;height:30px;background:#FF6600;border-radius:100px;" id="orange" onclick="color(this)"></div>
    <div style="position:absolute;top:5%;left:56%;width:30px;height:30px;background:black;border-radius:100px;" id="black" onclick="color(this)"></div>
    -->

 

     <!-- onclick="color(this)" -->
    <div id="colorPicker1"   style="top:15px;">
        <a class="color"><div class="colorInner"></div></a>
        <div class="track"></div>
        <ul class="dropdown"><li></li></ul>
        <input type="hidden" class="colorInput"/>
    </div>
    <div class="dropdown" id="brushSizes" style="top:15px;"> 
      <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">
        Brush
        <span class="caret"></span>
      </button>
      <ul class="dropdown-menu" role="menu" aria-labelledby="brushSizes">
        <li role="presentation"><a role="menuitem" tabindex="-1" href="#">Small</a></li>
        <li role="presentation"><a role="menuitem" tabindex="-1" href="#">Medium</a></li>
        <li role="presentation"><a role="menuitem" tabindex="-1" href="#">Large</a></li>
        <li role="presentation" class="divider"></li>
        <li role="presentation"><a role="menuitem" tabindex="-1" href="#">X-Large</a></li>
      </ul>
    </div>
    </div>


   <!-- <div class="borrar" style="position:absolute;top:20px;left:18%;font-family:sans-serif;color:#FF0000;font-size:30px">-->
   <div class="borrar"><strong>Eraser</strong><!--<div style="position:absolute;top:10%;left:24%;width:20px;height:20px;background:white;border:2px solid;" id="white" onclick="color(this)"></div>--><div style="width:20px;height:20px;background:white;border:2px black solid;" id="white" onclick="setEraser()"></div></div>
    
    
<div style="position:absolute;left:70%;top:30px">
    <button type="button" class="btn btn-default" onclick="erase()" style="margin: 10px;"> Start Over
    </button>
    <button id="save" type="button" class="btn btn-default"><i class="glyphicon glyphicon-floppy-disk"></i> Save</button>
    <button id="show-gallery" class="btn btn-primary" data-toggle="modal">View Gallery</button>
    <!--
    <button type="button" class="btn btn-default" onclick="onSave()"><span class="glyphicon glyphicon-envelope" onclick=""></span> email masterpiece</button> -->

</div>

 <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script src="https://cdn.firebase.com/js/client/1.0.18/firebase.js"></script>
<script type="text/javascript" src="js/jquery.tinycolorpicker.min.js"></script>
<!-- <script type="text/javascript" src="color.js"></script> -->

<script type="text/javascript">
 
COLOR = "#000000";


function setEraser(){
    COLOR = "#FFFFFF";

}


$(function() {


    console.log("Adding color picker");
    var picker = $("#colorPicker1").tinycolorpicker();

    picker.bind("change", function(e, color, rgbcolor) {

        var values = rgbcolor.split("(")[1].split(")")[0].split(",");
        window.COLOR = color;// {r: values[0], g: values[1], b: values[2]};

        console.log(values, COLOR);
        // changeColorTo(rgbcolor);
    });

    $(body)('touchmove', function(event) {

      event.prventDefault();

    });



    $("#brushSizes a").on("click", function(e) {
        e.preventDefault();
        console.log($(this).text());

        switch($(this).text()) {
            case "Small": y = 5; break;
            case "Medium": y = 20; break;
            case "Large": y = 50; break;
            case "X-Large": y = 100; break;
        };

        LINEWIDTH = y;
    });

    $("#save").on("click", function(e){
        e.preventDefault();

        var imageData = $("canvas").get(0).toDataURL();

        console.log("going to save the iamge");
        console.log(imageData);

        var fb = new Firebase("https://deviowa-draw.firebaseio.com/art-gallery");
        fb.push(imageData);
    });

    $("#show-gallery").on("click", function(e) {
        e.preventDefault();

        var fb = new Firebase("https://deviowa-draw.firebaseio.com/art-gallery");
        fb.once("value", function(d) {
            var files = d.val();

            console.log("here");

            var html = "";
            for (var key in files) {
                var filedata = files[key];
                var thisItem = "<img class='responsive img-thumbnail' width='250' src='" + filedata + "'>";
                html += thisItem;
            }

            $(".gallery-area").html(html);
            $("#art-gallery").modal();
        });
    });
});
</script>

<div class="modal fade" id="art-gallery">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title">Art Gallery</h4>
    </div>
    <div class="modal-body">
        <div class="gallery-area">
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
    </div>
</div><!-- /.modal-content -->
</div><!-- /.modal-dialog -->
</div><!-- /.modal -->

</body>
</html>

